<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <base href="/" />
  <title>Z-Build Order | Tournament Center</title>
  <meta name="description"
    content="Find, create, and run StarCraft 2 tournaments with live brackets, registration, and SC2Pulse seeding." />
  <meta property="og:title" content="Z-Build Order Tournament Bracket" />
  <meta property="og:description"
    content="Register players, seed by points and MMR, and track live brackets for your tournaments." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://zbuildorder.com/img/og-image.webp" />
  <link rel="icon" type="image/x-icon" href="/img/favicon.ico" />
  <link rel="stylesheet" href="/public/css/showToast.css" />
  <link rel="stylesheet" href="/public/css/tournament.css" />
</head>

<body class="tournament-body">
  <div id="toast-container"></div>

  <div id="auth-container" class="auth-floating">
    <div class="auth-info">
      <div id="authLoadingWrapper" class="auth-loading">
        <div id="authLoading" class="spinner"></div>
        <span id="authLoadingText">Loading user...</span>
      </div>

      <div class="user-details">
        <p id="userName" class="user-name fade-in" style="display: none;">Guest</p>
      </div>

      <img id="userPhoto" class="user-avatar fade-in" src="img/avatar/marine_avatar_1.webp" alt="User Avatar"
        style="display: none;" />

      <div id="userMenu" class="user-menu" style="display: none;">
        <div class="menu-section">
          <p id="userNameMenu" class="user-name fade-in">Guest</p>
          <p id="userMmrMenu" class="user-mmr" style="display: none;">MMR: --</p>
          <hr id="userNameDivider" class="menu-divider" />
          <button class="menu-item" id="mapVetoBtn">
            <img src="img/SVG/map-solid.svg" class="menu-icon" /> Map Veto
          </button>
          <hr class="menu-divider" />
          <button class="menu-item" id="showClanModalButton">
            <img src="img/SVG/clan.svg" class="menu-icon" /> Clans
          </button>
          <hr class="menu-divider" />
          <button id="showStatsButton" class="menu-item">
            <img src="img/SVG/stats.svg" class="menu-icon" /> My Stats
          </button>
          <hr class="menu-divider" />
          <button class="menu-item" id="settingsBtn">
            <img src="img/SVG/settings.svg" class="menu-icon" /> Settings
          </button>
          <hr class="menu-divider" />
          <button class="menu-item" id="switchAccountBtn">
            <img src="img/SVG/switch.svg" class="menu-icon" /> Switch Account
          </button>
          <button class="menu-item" id="signOutBtn">
            <img src="img/SVG/logout.svg" class="menu-icon" /> Sign Out
          </button>
        </div>
      </div>
    </div>

    <button id="signInBtn" class="auth-button">Sign In</button>
  </div>

  <div id="usernameModal" class="modal" style="display: none">
    <div class="modal-content">
      <h3>Choose a Username</h3>
      <input type="text" id="usernameInput" placeholder="Enter your username" />
      <br /><br />
      <button id="confirmUsernameButton">Confirm</button>
    </div>
  </div>

  <!-- Landing: list & create -->
  <section id="landingView" class="landing" style="display:none;">
    <div class="hero landing-hero">
      <div class="hero-main">
        <a class="ghost-link" href="/index.html">Back to Z-Build Order</a>
        <p class="eyebrow">Tournament Center</p>
        <h1>Find or host your SC2 tournament.</h1>
        <p class="lede">Browse tournaments or spin up a new one with custom links and formats.</p>
        <div class="hero-actions">
          <button id="openCreateTournament" class="cta primary">Create a tournament</button>
        </div>
      </div>
      <div class="hero-stats">
        <div class="stat-card">
          <p>Active tournaments</p>
          <h2 id="statTournaments">0</h2>
        </div>
        <div class="stat-card accent">
          <p>Next start</p>
          <h2 id="statNextStart">TBD</h2>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div>
          <p class="eyebrow">Browse</p>
          <h3>Open tournaments</h3>
        </div>
        <button id="refreshTournaments" class="cta ghost small">Refresh</button>
      </div>
      <ul id="tournamentList" class="tournament-list"></ul>
    </div>
  </section>

  <!-- Tournament detail -->
  <section id="tournamentView" style="display:none;">
    <header class="hero">
      <div class="hero-main">
        <a class="ghost-link" href="/tournament">All tournaments</a>
        <p class="eyebrow" id="tournamentFormat">Tournament</p>
        <h1 id="tournamentTitle">Tournament</h1>
        <div class="hero-actions">
          <button id="jumpToRegistration" class="cta primary">Add a player</button>
          <button id="openRegisterBtn" class="cta ghost" style="display:none;">Register</button>
          <button id="jumpToBracket" class="cta ghost">View bracket</button>
        </div>
        <div class="pill-row">
          <span class="pill">Auto-seed (points → MMR)</span>
          <span class="pill">Live sync (tabs)</span>
          <span class="pill">Walkover-ready</span>
        </div>
      </div>
      <div class="hero-stats">
        <div class="stat-card">
          <p>Registered</p>
          <h2 id="statPlayers">0</h2>
        </div>
        <div class="stat-card">
          <p>Bracket Size</p>
          <h2 id="statBracket">0</h2>
        </div>
        <div class="stat-card accent">
          <p>Start</p>
          <h2 id="tournamentStart">TBD</h2>
        </div>
      </div>
    </header>

    <main class="page-stack">
      <div class="tab-bar" id="tabBar">
        <button class="tab-btn active" data-tab="bracketTab">Bracket</button>
        <button class="tab-btn" data-tab="descriptionTab">Description</button>
        <button class="tab-btn" data-tab="registrationTab" id="adminTabBtn">Registration</button>
      </div>

      <section id="descriptionTab" class="tab-panel">
        <div class="card">
          <div class="card-header">
            <div>
              <p class="eyebrow">Overview</p>
              <h3>Description</h3>
            </div>
          </div>
          <div id="tournamentDescriptionBody" class="helper"></div>
        </div>
      </section>

      <section id="bracketTab" class="tab-panel active">
        <div class="card bracket-card">
          <div class="card-header">
            <div>
              <p class="eyebrow">Bracket</p>
              <h3 id="bracketTitle">Double elimination</h3>
            </div>
            <div class="live-dot">Live</div>
          </div>
          <div id="bracketGrid" class="bracket-grid">
            <div class="placeholder">No players yet. Add players to generate the bracket.</div>
          </div>
        </div>
        <div class="card activity-card">
          <div class="card-header">
            <div>
              <p class="eyebrow">Stream View</p>
              <h3>Live updates</h3>
            </div>
            <span class="badge muted">Local + cross-tab</span>
          </div>
          <ul id="activityList" class="activity-list"></ul>
        </div>
      </section>

      <section id="registrationTab" class="tab-panel">
        <div class="card" id="registrationCard">
          <div class="card-header">
            <div>
              <p class="eyebrow">Registration</p>
              <h3>Add or update players</h3>
            </div>
            <span class="badge muted">SC2Pulse × MMR</span>
          </div>
          <form id="registrationForm" class="form-grid">
            <label>
              Player name
              <input id="playerNameInput" type="text" placeholder="e.g. Hydralisk" required />
            </label>
            <label>
              Race
              <select id="raceSelect" disabled>
                <option value="Zerg">Zerg</option>
                <option value="Protoss">Protoss</option>
                <option value="Terran">Terran</option>
                <option value="Random">Random</option>
              </select>
            </label>
            <label class="readonly-field">
              SC2Pulse profile (set in Settings)
              <input id="pulseLinkDisplay" type="text" placeholder="Add your SC2Pulse link in Settings" readonly />
            </label>
            <label class="readonly-field">
              MMR (auto)
              <input id="mmrDisplay" type="text" placeholder="MMR will load from SC2Pulse" readonly />
            </label>
            <label>
              Starting points (optional)
              <input id="pointsInput" type="number" inputmode="numeric" min="0" placeholder="0" />
            </label>
            <div class="form-actions">
              <button type="submit" class="cta primary">Register</button>
              <button type="button" id="autoFillBtn" class="cta small ghost">Dev: Auto-fill 12 players</button>
            </div>
            <p id="mmrStatus" class="helper">Race and MMR load from your SC2Pulse profile in Settings.</p>
          </form>
        </div>

        <div class="card" id="seedingCard">
          <div class="card-header">
            <div>
              <p class="eyebrow">Seeding</p>
              <h3>Points-first ranking</h3>
            </div>
            <div class="seed-actions">
              <span id="seedingNotice" class="badge warning" style="display:none;">Seeding changed - rebuild needed</span>
              <button id="rebuildBracketBtn" class="cta small ghost">Apply to bracket</button>
              <button id="resetTournamentBtn" class="cta small subtle">Reset tournament</button>
            </div>
          </div>
          <div class="table-wrapper">
            <table class="players-table">
              <thead>
                <tr>
                  <th>Seed</th>
                  <th>Player</th>
                  <th>Points</th>
                  <th>MMR</th>
                  <th>SC2Pulse</th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="playersTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </section>

  <!-- Create tournament modal -->
  <div id="createTournamentModal" class="modal create-modal" style="display:none;">
    <div class="modal-content">
      <h3>Create tournament</h3>
      <label>Tournament name
        <input type="text" id="tournamentNameInput" placeholder="My Weekly Cup" />
      </label>
      <label>Custom URL slug
        <div class="inline-row">
          <span class="muted">https://zbuildorder.com/tournament/</span>
          <input type="text" id="tournamentSlugInput" placeholder="my-weekly-cup" />
          <button type="button" class="cta small ghost" id="generateSlugBtn">Random</button>
        </div>
        <p class="helper" id="slugStatus"></p>
      </label>
      <label>Description
        <div class="markdown-editor">
          <div class="markdown-toolbar">
            <button type="button" class="toolbar-btn" data-desc-action="heading">H2</button>
            <button type="button" class="toolbar-btn" data-desc-action="bold"><strong>B</strong></button>
            <button type="button" class="toolbar-btn" data-desc-action="italic"><em>I</em></button>
            <button type="button" class="toolbar-btn" data-desc-action="bullet">• List</button>
            <button type="button" class="toolbar-btn" data-desc-action="numbered">1. List</button>
            <button type="button" class="toolbar-btn" data-desc-action="quote">“ ”</button>
            <button type="button" class="toolbar-btn" data-desc-action="link">Link</button>
            <button type="button" class="toolbar-btn" data-desc-action="image">Image</button>
            <button type="button" class="toolbar-btn" data-desc-action="code">&lt;/&gt;</button>
          </div>
          <textarea id="tournamentDescriptionInput" class="markdown-input" rows="10" placeholder="Write rules, schedule, map pool..."></textarea>
        </div>
      </label>
      <div class="markdown-preview">
        <p class="eyebrow">Preview</p>
        <div id="tournamentDescriptionPreview" class="helper"></div>
      </div>
      <label>Format
        <select id="tournamentFormatSelect">
          <option value="Double Elimination">Double Elimination</option>
          <option value="Single Elimination">Single Elimination</option>
          <option value="Round Robin">Round Robin</option>
          <option value="Swiss">Swiss</option>
        </select>
      </label>
      <label>Max players
        <input type="number" id="tournamentMaxPlayersInput" min="2" max="512" placeholder="32" />
      </label>
      <label>Start time
        <input type="datetime-local" id="tournamentStartInput" />
      </label>
      <div class="form-actions">
        <button class="cta subtle" id="closeCreateTournament">Cancel</button>
        <button class="cta primary" id="saveTournamentBtn">Create</button>
      </div>
    </div>
  </div>

  <script type="module" src="/src/js/modules/tournament.js"></script>
</body>

</html>
